<!DOCTYPE html>
<html>
  <head>
    <script src="https://code.jquery.com/jquery-2.1.4.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Cookies.js/1.2.1/cookies.min.js"></script>
  </head>
  <body>
    <script>
      var urlParts = location.href.split('?');
      var queryParts = urlParts[1].split('&');
      var state = null;
      var code = null;
      for(var i = 0; i < queryParts.length; ++i) {
        paramParts = queryParts[i].split('=');
        if(paramParts[0] == 'state') {
          state = paramParts[1];
        } else if (paramParts[0] == 'code') {
          code = paramParts[1];
        }
      }
      if(state && code) {
        var tokenizeUrl = 'http://www.plot-my-trip.local.com:8000/api/auth/tokenize';
        var redirectUrl = '/webpack-dev-server/'
        if (window.location.href.indexOf('plot-my-trip.com') > 0) {
          tokenizeUrl = 'http://www.plot-my-trip.com/api/auth/tokenize';
          redirectUrl = '/';
        }
        
        $.post('', JSON.stringify({state, code}), function(data, textStatus) {
          var sevenDays = 60 * 60 * 24 * 7;
          Cookies.set('token', data, { expires: sevenDays });
          window.top.location.href = redirectUrl;
        });
      }
    </script>
  </body>
</html>
